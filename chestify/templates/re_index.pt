<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <script src="${request.static_url('chestify:static/bower_components/webcomponentsjs/webcomponents-lite.min.js')}"></script>
  <link rel="import" href="${request.static_url('chestify:static/bower_components/google-signin/google-signin.html')}" />
  <meta name="google-signin-client_id" content="687216091613-fqbv5u4cba3bpa6ihqgh8qr1h93klvap.apps.googleusercontent.com" />
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <title>Chestify Online Chest</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="${request.static_url('chestify:static/css/materialize.css')}" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="${request.static_url('chestify:static/css/style.css')}" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>
<body>
  <ul id="user_drop_down" class="dropdown-content">
    <li class="divider"></li>
    <li class="chip">
        <img class="user_image"src="" alt=""/>
        <a><span id="username_id" class=".user_name">Chestify User</span></a>
    </li>
    <li><a href="#!"><google-signin
    client-id="687216091613-fqbv5u4cba3bpa6ihqgh8qr1h93klvap.apps.googleusercontent.com"
    scopes="https://www.googleapis.com/auth/plus.login"
    scopes="https://www.googleapis.com/auth/plus.me"
    id="gLogin"
    height="medium"
    ></google-signin></a></li>
  </ul>
  <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">Your Online Chest</a>
      <ul class="right hide-on-med-and-down">

        <li><a class="dropdown-button" href="#!" data-activates="user_drop_down">Chestify<i class="material-icons right">arrow_drop_down</i></a></li>
        <!-- <li><a href="#!"></a></li> -->
      </ul>
      <ul class="right">
        <li>

        </li>
      </ul>

      <ul id="nav-mobile" class="side-nav">
        <li><h4 class="white-text"><a href="#">Chestify</a></h4></li>
        <li>
          <a>
            <div class="chip">
              <img class="user_image" src="" alt=""/>
              <span id="username_id" class="user_name">Chestify User</span>
            </div>
          </a>
        </li>
        <li><a href="#!"><google-signin
        client-id="687216091613-fqbv5u4cba3bpa6ihqgh8qr1h93klvap.apps.googleusercontent.com"
        scopes="https://www.googleapis.com/auth/plus.login"
        scopes="https://www.googleapis.com/auth/plus.me"
        id="gLogin"
        height="small"
        ></google-signin></a></li>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
  </nav>
<div id="main_container_bhas">
  <div class="section no-pad-bot" id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center orange-text">Chestify</h1>
      <div class="row center">
        <h5 class="header col s12 light">Your online storage. Our responsiblity.</h5>
      </div>
      <div class="row center">

      </div>
      <br><br>

    </div>
  </div>


  <div class="container" >
    <div class="section">

      <!--   Icon Section   -->
      <div class="row" style="text-align:center;">
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="material-icons">flash_on</i></h2>
            <h5 class="center">Speed</h5>

            <p class="light">We did most of the heavy lifting for you to provide a smooth storage online with minimum hassle . Additionally, we refined animations and transitions to provide a smoother experience for users to make them feel at home when using our product.</p>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="material-icons">group</i></h2>
            <h5 class="center">User Experience Focused</h5>

            <p class="light">By utilizing elements and principles of Material Design, we were able to create a framework that incorporates components and animations that provide more feedback to users. Additionally, a single underlying responsive system across all platforms allow for a more unified user experience.</p>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="material-icons">settings</i></h2>
            <h5 class="center">Easy to work with</h5>

            <p class="light">Very Intutive user iterface which works with all the devices across all sizes.With our premium account you can pay as you increase the amount of data that you trust with us </p>
          </div>
        </div>
      </div>

    </div>
    <br><br>

    <div class="section">

    </div>
  </div>
</div>
  <footer class="page-footer orange">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">Company Bio</h5>
          <p class="grey-text text-lighten-4">We are a team of college students working on this project like it's our full time job.The safety of out customer files is our utmost concern. Any amount would help support and continue development on this project and is greatly appreciated.</p>


        </div>
        <div class="col l6 s12">
          <h5 class="white-text">Founders</h5>
          <div class="col l3 s12">
            <h6 class="white-text">V.V.Bhaskaram</h6>
            <p class="white-text">Android Developer<br/>Language Enthusiast</p>
          </div>
          <div class="col l3 s12">
            <h6 class="white-text">J.Y.Sandilya</h6>
            <p class="white-text">Systems Engineer<br/>Graphics Enthusiast</p>
          </div>
        </div>

      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      Made by <a class="orange-text text-lighten-3" href="http://materializecss.com">Materialize</a>
      </div>
    </div>
  </footer>
  <div id="loadingDiv" class="container" style="width:100%;height:100%;background-color:rgba(255,255,255,0.3);z-index:500;position:absolute;top:0;left:0">
    <div class="preloader-wrapper big active s12 l3 offset-s4"  >
      <div class="spinner-layer spinner-blue-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
          <div class="circle"></div>
        </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
  </div>
  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="${request.static_url('chestify:static/materialize.js')}"></script>
  <script src="${request.static_url('chestify:static/js/init.js')}"></script>
  <script>
    $(document).ready(function(){
      $call_once = false;
      var $collapse_func = function(){
        $('.collapsible').collapsible({
          accordion : false // A setting that changes the collapsible behavior to expandable instead of the default accordion style
        });
      };
      //assume that this supports template
      //change with shadow root
      //assign template to values
      var $product_features = $('#product')[0].innerHTML;
      var $main_product = $('#folder')[0].innerHTML;
      //binding the login event
      $('#gLogin').on('google-signin-success',function(){
          //change this only after a successful reply from server
          //get id token
          var auth2 = gapi.auth2.getAuthInstance();
          var profile = auth2.currentUser.get().getBasicProfile();
          console.log(profile.getName());
          if(profile){
            $('#username_id').html(profile.getName()) ;
            $('.user_name').html(profile.getName());
            $('.user_image').attr('src', profile.getImageUrl()) ;
          }else{
            console.log('we need some debugging ');
          }
          var id_token = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token;
          var xhr = new XMLHttpRequest();
  				xhr.open('POST',location.origin+'/login');
  				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  				xhr.onload = function(){
  					alert('the response is ' + xhr.responseText);
            if(xhr.responseText == 'accepted'){
              $('#main_container_bhas').replaceWith($main_product);
              //now get the list of files
              alert('what is this ');
              var $json_data = "";
              var $cur_path = "" ;
              var $files_string = function(name,size,date_created){
                return ('<li name = "'+
                name+
                '"><div class="collapsible-header"><i class="material-icons">insert_drive_file</i>' +
                 name +
                  '</div><div class="collapsible-body orange"><p>Size : '+size+' Bytes<br/>Created : '+date_created+
                '<br/><a class="btn"><i class="material-icons">file_download</i><span class="url_download_button" name="'+name+'">Download URL</span></a><br/>'+
                '<br/><a class="btn"><i class="material-icons">share</i> <span class="shared_download_button" name="'+ name +'">Share URL</span></a></p>'+
                '</div></li>');
              }
              var $folder_string = function(name){
                return '<li name="'+name+'"><div class="collapsible-header"><i class="material-icons">folder</i>' + name + '</div></li>';
              }
              var $display_func = function(path){
                var temp_path = path || "/";
                $cur_path = temp_path;
                $('#cur_path').html($cur_path);
                var myNode = document.getElementById("files");
                while (myNode.firstChild) {
                    myNode.removeChild(myNode.firstChild);
                }
                var myNode = document.getElementById("folders");
                while (myNode.firstChild) {
                    myNode.removeChild(myNode.firstChild);
                }
                function get_folder_names(value , index , ar){
                  if(value.length > 0 && value != " "){
                    console.log(value + 'passed ');
                    return true;
                  }
                  else{
                    console.log(value + 'failed ');
                    return false;
                  }
                };
                console.log("temp_path  = " +temp_path.split('/'));
                var folders = temp_path.split('/').filter(get_folder_names);
                console.log("folders = "+ folders);
                if(folders.length != 0){
                  var obj = $json_data['folders'];
                  console.log("obj value = " + JSON.stringify(obj));
                  console.log("folders length = "+ folders.length);
                  for(var i = 0 ; i < folders.length ; i++ ){
                    if(i == folders.length - 1 ){
                      obj = obj[folders[i]];
                    }
                    else{
                      obj = obj[folders[i]]['folders'];
                    }
                    console.log(JSON.stringify(obj));
                  }
                  console.log("final = " +JSON.stringify(obj));
                }
                else{
                  if(temp_path == '/'){var obj = $json_data;}
                  else{console.log('please check this one ');}
                }
                for(file in obj['files']){
                  console.log(file);
                  var size = obj['files'][file]['size'];
                  var date_created = obj['files'][file]['last_modified']
                  $('#files').append($files_string(file, size , date_created));
                }
                $('.url_download_button').click(function(){
                  //alert('clicked');
                  var name = $(this).attr('name');
                  //alert('name ' + name);
                  var file_path = "";
                  if( $cur_path == '/'){
                    file_path = name;
                  }else{
                    file_path = $cur_path.slice(1) + '/' + name;
                  }
                  $.get(location.origin + '/download-url' ,{key : file_path} , function(data,status){
                    console.log(data['url']);
                    //alert(data['url']);
                    $('#download_file_name').html(name);
                    $('#download_link').attr('href',data['url']);
                    $('#modal1').openModal();
                  } );
                  console.log('Request for file '+ name);
                });
                $('.shared_download_button').click(function(){
                  //alert('clicked');
                  var name = $(this).attr('name');
                  //alert('name ' + name);
                  var file_path = "";
                  if( $cur_path == '/'){
                    file_path = name;
                  }else{
                    file_path = $cur_path.slice(1) + '/' + name;
                  }
                  $.post(location.origin + '/generate-shared' ,{key : file_path} , function(data,status){
                    console.log(data['link_id']);
                    alert(data['link_id']);
                  } );
                  console.log('Request for file '+ name);
                });
                for(folder in obj['folders']){
                  console.log(folder);
                  $('#folders').append($folder_string(folder));
                }
                if(!$call_once){
                  $collapse_func();
                  $call_once  = true;
                }
              }
              function listRequest (){
                $.get(location.origin + '/list',function(data, status){
                  $json_data = data;
                  $display_func();
                  alert($json_data.folders);
                  $('#cur_path').html($cur_path);
                });
              }
              $.get(location.origin + '/list',function(data , status){
                $json_data = data;
                $display_func();
                console.log($json_data.folders);
                $('#cur_path').html($cur_path );
              });
              function getEventTarget(e) {
                e = e || window.event;
                return e.target || e.srcElement;
              }

              // $('#files').on('click',"li",function(){
              //   var name = this.getAttribute('name');
              //   var file_path = "";
              //   if( $cur_path == '/'){
              //     file_path = name;
              //   }else{
              //     file_path = $cur_path.slice(1) + '/' + name;
              //   }
              //   $.get(location.origin + '/download-url' ,{key : file_path} , function(data,status){
              //     console.log(data['url']);
              //     alert(data['url']);
              //   } );
              //   console.log('Request for file '+ name);
              // });
              $('#folders').on("click","li",function(){
                var name = (this.getAttribute('name'));
                if($cur_path == '/'){
                  name = "/"+(name);
                }
                else{
                  name  = $cur_path + '/'+(name);
                }
                console.log(name);
                $display_func( name);
              });
              $('#back_button').click(function(){
                var path = $cur_path ;
                path  = path.split('/').filter(function (value , index , ar){
                  if(value.length > 0 ){
                    console.log(value + 'passed ');
                    return true;
                  }
                  else{
                    console.log(value + 'failed ');
                    return false;}
                }).slice(0,-1).join('/');
                console.log(path + '********');
                $display_func('/'+path);
              });
              var $file_size = 0 ;
              $('#file_upload').bind('change', function() {
                alert("Size of the file uploaded " + this.files[0].size);
                $file_size = this.files[0].size;
              });
              $('#upload_file').click(function(){
                var file_path = "" ;
                if ($cur_path == '/'){
                  file_path = "" + $('#file_upload').val();
                }else{
                  file_path = $cur_path.slice(1)+'/' + $('#file_upload').val();
                }
                if($('#file_upload').val()){
                alert($('#file_upload').val());
                $.post(
                  location.origin + '/upload-url',
                  {
                    'key':file_path,
                    'file_size':$file_size
                  } ,
                  function(data,status){
                      function progressHandlingFunction(e){
                        if(e.lengthComputable){
                          $('progress').attr({value:e.laoded , max:e.total});
                        }
                      }
                      if(data['message'] == 'success'){
                        var file_input_element = document.getElementById('file_upload');
                        var file = file_input_element.files[0];
                        $file_value = "";
                        if(file){
                          alert(data['url']);
                          var xhr = new XMLHttpRequest();
                          xhr.open('PUT',data['url'],true);
                          xhr.upload.addEventListener('progress',progressHandlingFunction);
                          var reader = new FileReader();
                          reader.onload = function(evt){

                            //alert('done dana done done Sending ');
                            var file_type = file.type;
                            var str = evt.target.result;
                            var blob = new Blob([str] ,{'type':""});
                            //xhr.setRequestHeader('X-HTTP-Method-Override','PUT');
                            xhr.setRequestHeader('Content-Type',"");
                            xhr.send(blob);
                          }
                          xhr.onload = function(){
                            alert('done');
                            $.get(location.origin + '/list' , function(data,status){
                              $json_data = data;
                              console.log(JSON.stringify($json_data));
                              $display_func($cur_path);
                            });
                        };
                          reader.readAsBinaryString(file);
                        }else{
                          alert('Please select valid file ');
                        }

                      }else{
                        alert('Couldnt upload values ' + data['message']);
                      }
                    }
                  );
                }else{
                  alert('Please select the value ');
                }
              });
              $('#create_directory').click(function(){
                if($.trim($('#dir_name').val()) != "" ){
                  var file_path = "";
                  if($cur_path == '/'){
                    file_path = $.trim($('#dir_name').val());
                  }
                  else{
                    file_path = $cur_path.slice(1) +'/' +$.trim($('#dir_name').val())
                  }
                  $.post(location.origin+'/makedir' , {key:file_path },function(data,status){
                    alert(data + 'data');
                    $.get(location.origin + '/list' , function(data,status){
                      $json_data = data;
                      console.log("result from data = " + JSON.stringify($json_data));
                      $display_func($cur_path);
                    });
                  });

                }
                else{
                  console.log('not today');
                }
              });
            }
            else{
              alert(xhr.responseText);
              $('google-signin')[0].signOut();
            }
  				}
  				xhr.send('id_token='+id_token );

      });
      //binding the logout event
      $('#gLogin').on('google-signed-out',function(){
        $('#main_container_bhas').replaceWith($product_features);
        $('#username_id').html('Chestify');
        var signedoutRequest = new XMLHttpRequest();
        signedoutRequest.open('GET',location.origin+'/logout');
        signedoutRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        signedoutRequest.onload = function(){
          if(signedoutRequest.status != 200){return;}
          alert('the user has signed out ' + signedoutRequest.responseText);
        }
        signedoutRequest.send();
      });
      var $loading = $('#loadingDiv').hide();
      $(document)
        .ajaxStart(function () {
          $loading.show();
        })
        .ajaxStop(function () {
          $loading.hide();
        });
    });
  </script>
  <template id="folder">
    <div id="main_container_bhas">
      <div class="container">
        <br/><br/>
        <br/><br/>
        <div class="row l8 s12">
          <div class="card-panel light-blue lighten-1 ">
            Path : <span id="cur_path">Folder Name here</span>
            <a href="#!" class="right #757575 waves-effect waves-light btn-flat" id="back_button">Back</a>
            <h4 class="white-text">Folders</h4>
            <div class="l3 s12">
              <ul id="folders" class="collapsible" data-collapsible="accordion">
                <li>
                  <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
                  <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
                </li>
                <li>
                  <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
                  <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
                </li>
                <li>
                  <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
                  <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
                </li>
              </ul>
            </div>
            <h4 class="white-text">Files</h4>
              <ul class="l3 s12">
                <ul id="files" class="collapsible popout" data-collapsible="accordion">
                  <<li>
                    <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
                    <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
                  </li>
                  <li>
                    <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
                    <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
                  </li>
                  <li>
                    <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>
                    <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>
                  </li>
                </ul>
              </ul>
              <div id="modal1" class="modal bottom-sheet">
                <div class="modal-content">
                  <h4 id="download_file_name">Modal Header</h4>
                  <p ><a href="" id="download_link" class="btn" target="_blank">start download</a></p>
                </div>
              </div>
            <h4 class="white-text">Utils</h4>
            <div class="l3 s12">
              <form action="#" id="upload_form" method="put" enctype="multipart/form-data">
                 <div class="file-field input-field ">
                   <div class="btn">
                     <span>File</span>
                     <input name="file" type="file" id="file_upload">
                   </div>
                   <div class="file-path-wrapper">
                     <input class="file-path validate" type="text">
                   </div>
                 </div>
               </form>
               <a href="#!" class="waves-effect waves-light btn" id="upload_file">upload</a>
               <form action="#">
                 <div class="input-field">
                   <input id="dir_name" placeholder="New Directory Name" type="text" class="validate">
                   <a class="waves-effect waves-light modal-trigger btn" id="create_directory" href="#!">Create Folder</a>
                 </div>
               </form>
            </div>
            <div class="l3 s12">

          </div>
        </div>

      </div>

    </div>

  </template>
  <template id="product">
    <div id="main_container_bhas" >
      <div class="section no-pad-bot" id="index-banner">
        <div class="container">
          <br><br>
          <h1 class="header center orange-text">Chestify</h1>
          <div class="row center">
            <h5 class="header col s12 light">Your online storage. Our responsiblity.</h5>
          </div>
          <br><br>
        </div>
      </div>
      <div class="container" >
        <div class="section">
          <div class="row" style="text-align:justified;">
            <div class="col s12 m4">
              <div class="icon-block">
                <h2 class="center light-blue-text"><i class="material-icons">flash_on</i></h2>
                <h5 class="center">Speed</h5>
                <p class="light">We did most of the heavy lifting for you to provide a smooth storage online with minimum hassle . Additionally, we refined animations and transitions to provide a smoother experience for users to make them feel at home when using our product.</p>
              </div>
            </div>
            <div class="col s12 m4">
              <div class="icon-block">
                <h2 class="center light-blue-text"><i class="material-icons">group</i></h2>
                <h5 class="center">User Experience Focused</h5>
                <p class="light">By utilizing elements and principles of Material Design, we were able to create a framework that incorporates components and animations that provide more feedback to users. Additionally, a single underlying responsive system across all platforms allow for a more unified user experience.</p>
              </div>
            </div>
            <div class="col s12 m4">
              <div class="icon-block">
                <h2 class="center light-blue-text"><i class="material-icons">settings</i></h2>
                <h5 class="center">Easy to work with</h5>
                <p class="light">Very Intutive user iterface which works with all the devices across all sizes.With our premium account you can pay as you increase the amount of data that you trust with us </p>
              </div>
            </div>
          </div>
        </div>
        <br><br>
      </div>
    </div>
  </template>
  </body>
</html>
<!--
// var folders = document.getElementById('folders');
// folders.onclick = function(event){
//   var target = getEventTarget(event);
//   var name  = $cur_path + '/'+(target.innerHTML);
//   if($cur_path == '/'){
//     name = "/"+(target.innerHTML);
//   }
//   else{
//     name  = $cur_path + '/'+(target.innerHTML);
//   }
//   console.log(name);
//   $display_func( name);
// };


// var files = document.getElementById('files');
// files.onclick = function(event) {
//     var target = getEventTarget(event);
//     var name = (target.innerHTML);
//     var file_path = "";
//     if( $cur_path == '/'){
//       file_path = name;
//     }else{
//       file_path = $cur_path.slice(1) + '/' + name;
//     }
//     $.get(location.origin + '/download-url' ,{key : file_path} , function(data,status){
//       console.log(data['url']);
//       alert(data['url']);
//     } );
//     console.log('Request for file '+ name);
// };
-->
